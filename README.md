# SmallTalk

这个项目是计算机网络通信大作业的记录。在这个作业中将尝试实现一个简易的网络聊天室。

## 作业要求

### 项目任务

1. 一对一聊天程序：两个用户之间实现网络数据传输。
2. 多用户聊天程序：分为服务器与客户端，服务器能够支持多个用户之间的一对一聊天，实现网络数据传输（实现功能2即不必实现功能1）。工作过程：服务器启动后，侦听指定端口，客户端使用套接字传输消息，由服务器转发至另一客户端。
3. 文件传输：实现用户之间的文件传输，不限文件类型。
4. 扩展功能：参考现有聊天程序扩展功能（例如群组聊天、使用表情、语音聊天等）。

### 项目要求

1. 一人独立完成。
2. 可使用C/C++/C#/Java/Python等语言，Windows/Linux平台均可，可借助Socket类库。
3. 服务器与客户端可以是同一台电脑上的不同进程，也可以使用多台电脑/虚拟机实现。
4. 需要实现友好的用户界面。

## 实现想法

### 开发环境

本次作业使用QT进行。

### 初步构想

本项目采用Tcp通信，将主要分为两部分，客户端和服务端。进行聊天通信时客户端将信息或文件传输给服务端，由服务端分发给同一聊天室内的其他客户端。

#### 服务端

每当创建一个新的聊天室时，便需要启动一个新的服务端。初步设想的服务端界面由如下控件组成

- 聊天内容窗口
- 监听端口号和确认键，确认键在连接成功后会变成断开键

#### 客户端

客户端主要由如下控件组成

- 菜单栏，进行服务器的连接与断开，文件和本地表情的发送
- 聊天内容窗口
- 聊天内容输入，发送键

##### 文件发送

发送和接收的文件会自动存储在doc文件夹下，每次关闭程序会自动清空文件夹，因此记得及时保存。

##### 表情发送

本地表情默认文件夹为img文件夹，不会被自动清理。

#### 数据格式

使用json格式，如下

```json
{
    "userName":"UserName", 
    "contentType":"text/file/img", 
    "content":"The data of transmition.And as for file, it's the name of file."
}
```

对于文件和表情而言，content字段为另一个json对象，用于存储文件名和文件大小。在接收到json文件后接收端会返回一个收到字符串，然后发送端真正开始发送文件。

## 已知Bug

- [x] 客户端连接失败时按键错误变成可点击的状态
- [x] 文件发送二进制文件有问题，主要问题在于json原生不支持二进制格式的存储（放弃使用json传递二进制数据，改为两次传输）
- [x] 发送大文件会出现损坏的情况（Bug修复说明：对于TcpSocket的Write函数而言，当传入的参数长度大于0x10000时，会自动将其分片，故在接收端应该多次接收传入的数据包并最终进行拼接）
- [x] 关闭客户端时无法自动删除文件

